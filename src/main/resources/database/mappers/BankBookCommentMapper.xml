<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
   <mapper namespace="com.iu.s1.bankBook.BankBookCommentDAO">
   	
   	<!-- sql의 부품화 다른 쿼리문에도 사용하게 끔-->
   	<sql id="commentCondition">
   		<trim prefix="where" suffixOverrides="and">
  	  		BOOKNUMBER = #{bookNumber} AND
  	  		
  	  		<if test="kind == 'contents'">
  	  		 CONTENTS LIKE '%'||#{search}||'%'
  	  		</if>
  	  		
  	  		<if test="kind == 'writer'">
  	  		 WRITER LIKE '%'||#{search}||'%'
  	  		</if>	  	
  	  	</trim>
   	</sql>
   
  	
  	<!-- List -->
  	  <select id="getTotalCount" resultType="Long" parameterType="Pager">
  	  	SELECT COUNT(NUM) FROM BANKBOOKCOMMENT
  	 	<include refid="commentCondition"></include> 	 
  	  </select>
  	  											<!-- BankBookCommentDTO는 BbsDTO를 상속받으니까 사용가능~~~ -->
  	  <select id="getBoardList" resultType="BankBookCommentDTO" parameterType="Pager">
  	  	SELECT * FROM
  	  	(
  	  		SELECT ROWNUM R, C.* FROM
  	  	<!-- ↓ROW NUM을 만들기 위해 가상의 테이블로 설정하기 -->
  	  		(
  	  			SELECT * FROM BANKBOOKCOMMENT
		  	  	<include refid="commentCondition"></include>
		  	  	ORDER BY NUM DESC
		  	  	)C 
  	  	)
  	  	WHERE R BETWEEN #{startRow} AND #{lastRow}
  	  </select>
  	  
  	  
  	
	
  </mapper>
  